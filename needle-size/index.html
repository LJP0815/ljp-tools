<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="google-site-verification" content="roIDWRbDD6DNTvcDg5RXmFdXb4aWarya16oUp98scw0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="title">ğŸ§¶ é‡ã‚µã‚¤ã‚ºã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ï½œNeedle Size Advisor</title>
  <meta name="description" content="ã‚²ãƒ¼ã‚¸ï¼ˆç›®æ•°ãƒ»æ®µæ•°ï¼‰ã¨ç¾åœ¨ã®é‡ã‚µã‚¤ã‚ºã‹ã‚‰ã€æŒ‡å®šã‚²ãƒ¼ã‚¸ã«è¿‘ã¥ããŸã‚ã®æ¨å¥¨é‡ã‚µã‚¤ã‚ºã‚’ææ¡ˆã—ã¾ã™ã€‚" />
  <link rel="icon" href="../favicon.png">

  <style>
    .container {
      max-width: 820px;
      margin: 2em auto;
      padding: 2em;
      background: #fefefe;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      font-family: 'Noto Sans JP', sans-serif;
    }
    h1 { text-align: center; font-size: 2rem; margin: 0.2em 0 0.6em; }
    p.description { text-align: center; color: #666; margin-bottom: 1.6em; line-height: 1.6; }

    .topbar {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 1em;
      font-size: 0.95rem;
    }
    .topbar button {
      background: none;
      border: none;
      cursor: pointer;
      color: #007bff;
      font-weight: 700;
      padding: 6px 8px;
      border-radius: 8px;
    }
    .topbar button.active {
      background: rgba(0,123,255,0.10);
      color: #0056b3;
    }
    .topbar .sep { color: #bbb; padding: 6px 0; }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.2em;
    }
    @media (min-width: 840px) {
      .grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .card {
      border: 1px solid #eee;
      border-radius: 14px;
      padding: 1.2em;
      background: #fff;
    }
    .card h2 {
      font-size: 1.05rem;
      margin: 0 0 0.8em;
      padding-bottom: 0.6em;
      border-bottom: 2px solid #f3f3f3;
    }

    .input-group { margin-bottom: 0.9em; }
    .input-group label { font-weight: 700; display: block; margin-bottom: 0.35em; }
    .input-group input, .input-group select {
      width: 100%;
      padding: 0.55em;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-sizing: border-box;
    }
    .hint { font-size: 0.85rem; color: #888; margin-top: 0.35em; line-height: 1.5; }

    .btn {
      display: block;
      width: 100%;
      padding: 1em;
      font-size: 1.12rem;
      font-weight: 800;
      color: #fff;
      background-color: #007bff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 1.0em;
    }
    .btn:hover { background-color: #0056b3; }

    .results {
      margin-top: 1.6em;
      border-top: 1px solid #eee;
      padding-top: 1.4em;
    }
    .big {
      font-size: 1.35rem;
      font-weight: 900;
      margin: 0 0 0.6em;
    }
    .sub {
      color: #333;
      line-height: 1.65;
      margin: 0.4em 0;
    }
    .pill {
      display: inline-block;
      background: #f6f8ff;
      border: 1px solid #e7ecff;
      color: #223;
      padding: 0.28em 0.6em;
      border-radius: 999px;
      font-size: 0.9rem;
      margin-right: 0.4em;
      margin-bottom: 0.35em;
    }
    .muted { color: #666; }
    .warn { color: #8a4b00; }
    .ok { color: #1d6f42; }

    footer {
      margin-top: 2.4em;
      text-align: center;
      color: #999;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="topbar">
      <div>
        <button id="btnJa" class="active">JP</button>
        <span class="sep">/</span>
        <button id="btnEn">EN</button>
      </div>
      <span class="sep">|</span>
      <div>
        <button id="btnCm" class="active" data-unit="cm">10cm</button>
        <span class="sep">/</span>
        <button id="btnIn" data-unit="in">4in</button>
      </div>
    </div>

    <h1 data-i18n="title">ğŸ§¶ é‡ã‚µã‚¤ã‚ºã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ï½œNeedle Size Advisor</h1>
    <p class="description" data-i18n="description">
      ã‚²ãƒ¼ã‚¸ï¼ˆç›®æ•°ãƒ»æ®µæ•°ï¼‰ã¨ç¾åœ¨ã®é‡ã‚µã‚¤ã‚ºã‹ã‚‰ã€æŒ‡å®šã‚²ãƒ¼ã‚¸ã«è¿‘ã¥ããŸã‚ã®æ¨å¥¨é‡ã‚µã‚¤ã‚ºã‚’ææ¡ˆã—ã¾ã™ã€‚
    </p>

    <div class="grid">
      <div class="card">
        <h2 data-i18n="patternTitle">ğŸ“Œ ãƒ‘ã‚¿ãƒ¼ãƒ³æŒ‡å®šã‚²ãƒ¼ã‚¸</h2>

        <div class="input-group">
          <label for="pSt" data-i18n="stLabel">ç›®æ•°</label>
          <input type="number" inputmode="decimal" id="pSt" step="0.1" placeholder="20">
          <div class="hint" id="pStHint"></div>
        </div>

        <div class="input-group">
          <label for="pRow" data-i18n="rowLabel">æ®µæ•°</label>
          <input type="number" inputmode="decimal" id="pRow" step="0.1" placeholder="28">
          <div class="hint" id="pRowHint"></div>
        </div>
      </div>

      <div class="card">
        <h2 data-i18n="yourTitle">ğŸ§µ è‡ªåˆ†ã®ã‚²ãƒ¼ã‚¸</h2>

        <div class="input-group">
          <label for="ySt" data-i18n="stLabel">ç›®æ•°</label>
          <input type="number" inputmode="decimal" id="ySt" step="0.1" placeholder="22">
          <div class="hint" id="yStHint"></div>
        </div>

        <div class="input-group">
          <label for="yRow" data-i18n="rowLabel">æ®µæ•°</label>
          <input type="number" inputmode="decimal" id="yRow" step="0.1" placeholder="30">
          <div class="hint" id="yRowHint"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:1.2em;">
      <h2 data-i18n="needleTitle">ğŸª¡ ç¾åœ¨ã®é‡ã‚µã‚¤ã‚º</h2>

      <div class="input-group">
        <label for="needleMm" data-i18n="needleLabel">é‡ã‚µã‚¤ã‚ºï¼ˆmmï¼‰</label>
        <input type="number" inputmode="decimal" id="needleMm" step="0.25" placeholder="4.0">
        <div class="hint" data-i18n="needleHint">â€» mmå…¥åŠ›ã‚’æ¨å¥¨</div>
      </div>

      <button class="btn" id="calcBtn" data-i18n="calcBtn">æ¨å¥¨é‡ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ã™ã‚‹</button>

      <div class="results" id="results">
        <div class="big" id="headline" data-i18n="initialHeadline">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
        <div class="sub muted" id="sub1" data-i18n="initialSub">æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>
        <div class="sub" id="sub2"></div>
        <div class="sub" id="sub3"></div>
        <div class="sub muted" id="footerNote"></div>
      </div>
    </div>

    <footer>
      <small data-i18n="footer">Free knitting tools by LemonJellyPool</small>
    </footer>
  </div>

<script>
/* =========================
   i18n
========================= */
const i18n = {
  ja: {
    title: "ğŸ§¶ é‡ã‚µã‚¤ã‚ºã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ï½œNeedle Size Advisor",
    description: "ã‚²ãƒ¼ã‚¸ï¼ˆç›®æ•°ãƒ»æ®µæ•°ï¼‰ã¨ç¾åœ¨ã®é‡ã‚µã‚¤ã‚ºã‹ã‚‰ã€æŒ‡å®šã‚²ãƒ¼ã‚¸ã«è¿‘ã¥ããŸã‚ã®æ¨å¥¨é‡ã‚µã‚¤ã‚ºã‚’ææ¡ˆã—ã¾ã™ã€‚",

    patternTitle: "ğŸ“Œ ãƒ‘ã‚¿ãƒ¼ãƒ³æŒ‡å®šã‚²ãƒ¼ã‚¸",
    yourTitle: "ğŸ§µ è‡ªåˆ†ã®ã‚²ãƒ¼ã‚¸",
    needleTitle: "ğŸª¡ ç¾åœ¨ã®é‡ã‚µã‚¤ã‚º",

    stLabel: "ç›®æ•°",
    rowLabel: "æ®µæ•°",
    needleLabel: "é‡ã‚µã‚¤ã‚ºï¼ˆmmï¼‰",
    needleHint: "â€» mmå…¥åŠ›ã‚’æ¨å¥¨ï¼ˆæµ·å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚‚å¯¾å¿œã—ã‚„ã™ã„ï¼‰ã€‚",

    calcBtn: "æ¨å¥¨é‡ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ã™ã‚‹",

    initialHeadline: "çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™",
    initialSub: "æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚",

    // dynamic templates
    perUnit: (unit) => unit === "cm" ? "ï¼ˆ10cmã‚ãŸã‚Šï¼‰" : "ï¼ˆ4inchã‚ãŸã‚Šï¼‰",
    stHint: (unit) => unit === "cm" ? "ä¾‹ï¼š20ç›® / 10cm" : "ä¾‹ï¼š20ç›® / 4in",
    rowHint: (unit) => unit === "cm" ? "ä¾‹ï¼š28æ®µ / 10cm" : "ä¾‹ï¼š28æ®µ / 4in",

    // result texts
    keepNeedle: "é‡ã‚µã‚¤ã‚ºã¯ã»ã¼é©æ­£ã§ã™ï¼ˆå¤‰æ›´ä¸è¦ã®å¯èƒ½æ€§ãŒé«˜ã„ï¼‰ã€‚",
    tryNeedle: (a,b) => `æ¨å¥¨ï¼š ${a} â€“ ${b} mm ã‚’è©¦ã—ã¦ãã ã•ã„`,
    directionUp: "ã‚ãªãŸã¯ã‚„ã‚„ã€Œãã¤ã‚ã€ã§ã™ â†’ é‡ã‚µã‚¤ã‚ºã‚’ä¸Šã’ã‚‹æ–¹å‘ã§ã™ã€‚",
    directionDown: "ã‚ãªãŸã¯ã‚„ã‚„ã€Œã‚†ã‚‹ã‚ã€ã§ã™ â†’ é‡ã‚µã‚¤ã‚ºã‚’ä¸‹ã’ã‚‹æ–¹å‘ã§ã™ã€‚",

    stitchDelta: (p,y) => `ç›®æ•°ï¼šãƒ‘ã‚¿ãƒ¼ãƒ³ ${p} / ã‚ãªãŸ ${y}`,
    rowDelta: (p,y) => `æ®µæ•°ï¼šãƒ‘ã‚¿ãƒ¼ãƒ³ ${p} / ã‚ãªãŸ ${y}`,

    rowOk: "æ®µæ•°ã¯è¿‘ã„ã§ã™ ğŸ‘",
    rowNote: "æ®µæ•°ã¯é‡ã‚µã‚¤ã‚ºå¤‰æ›´å¾Œã«è‡ªç„¶ã«è¿‘ã¥ãã“ã¨ã‚‚å¤šã„ã§ã™ã€‚ã‚ºãƒ¬ãŒå¤§ãã„å ´åˆã¯æ‰‹åŠ æ¸›ã‚„ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã‚‚æ¤œè¨ã—ã¦ãã ã•ã„ã€‚",

    disclaimer: "â€»ç·¨ã¿æ–¹ãƒ»ç³¸ãƒ»ç´ æã§å€‹äººå·®ãŒã‚ã‚Šã¾ã™ã€‚æœ¬ç•ªå‰ã«å¿…ãšã‚¹ãƒ¯ãƒƒãƒã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚",

    err: "æ•°å€¤ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚ç›®æ•°ãƒ»æ®µæ•°ãƒ»é‡ã‚µã‚¤ã‚ºï¼ˆmmï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"
  },

  en: {
    title: "ğŸ§¶ Needle Size Advisor",
    description: "Get a needle-size suggestion based on stitch/row gauge differences.",

    patternTitle: "ğŸ“Œ Pattern gauge",
    yourTitle: "ğŸ§µ Your gauge",
    needleTitle: "ğŸª¡ Current needle size",

    stLabel: "Stitches",
    rowLabel: "Rows",
    needleLabel: "Needle size (mm)",
    needleHint: "Tip: mm is recommended (works well with international patterns).",

    calcBtn: "Calculate recommended needle size",

    initialHeadline: "Your result will appear here",
    initialSub: "Enter values and press the button.",

    perUnit: (unit) => unit === "cm" ? "(per 10 cm)" : "(per 4 in)",
    stHint: (unit) => unit === "cm" ? "e.g., 20 sts / 10 cm" : "e.g., 20 sts / 4 in",
    rowHint: (unit) => unit === "cm" ? "e.g., 28 rows / 10 cm" : "e.g., 28 rows / 4 in",

    keepNeedle: "Your needle size looks close (you may not need to change it).",
    tryNeedle: (a,b) => `Try: ${a} â€“ ${b} mm`,
    directionUp: "Your fabric is tighter than the pattern â†’ go UP a needle size.",
    directionDown: "Your fabric is looser than the pattern â†’ go DOWN a needle size.",

    stitchDelta: (p,y) => `Stitches: pattern ${p} / yours ${y}`,
    rowDelta: (p,y) => `Rows: pattern ${p} / yours ${y}`,

    rowOk: "Row gauge looks good ğŸ‘",
    rowNote: "Row gauge often changes after adjusting needle size. If it still differs a lot, consider tension and blocking.",

    disclaimer: "Needle sizing is approximate. Always knit a swatch before starting your project.",

    err: "Missing values. Please enter stitches, rows, and needle size (mm)."
  }
};

let currentLang = localStorage.getItem("lang") || "ja";
let currentUnit = localStorage.getItem("unit") || "cm";

function applyLang(lang) {
  currentLang = lang;
  localStorage.setItem("lang", lang);
  document.documentElement.lang = lang;

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.dataset.i18n;
    const val = i18n[lang][key];
    if (typeof val === "string") el.textContent = val;
  });

  // meta description switch
  const metaDesc = document.querySelector('meta[name="description"]');
  if (metaDesc) metaDesc.setAttribute("content", i18n[lang].description);

  // toggle active states
  document.getElementById("btnJa").classList.toggle("active", lang === "ja");
  document.getElementById("btnEn").classList.toggle("active", lang === "en");

  applyUnit(currentUnit, true);
}

function applyUnit(unit, skipStore=false) {
  currentUnit = unit;
  if (!skipStore) localStorage.setItem("unit", unit);

  document.getElementById("btnCm").classList.toggle("active", unit === "cm");
  document.getElementById("btnIn").classList.toggle("active", unit === "in");

  // update hints
  const t = i18n[currentLang];
  document.getElementById("pStHint").textContent = `${t.stHint(unit)} ${t.perUnit(unit)}`;
  document.getElementById("pRowHint").textContent = `${t.rowHint(unit)} ${t.perUnit(unit)}`;
  document.getElementById("yStHint").textContent = `${t.stHint(unit)} ${t.perUnit(unit)}`;
  document.getElementById("yRowHint").textContent = `${t.rowHint(unit)} ${t.perUnit(unit)}`;
}

/* =========================
   Calculation helpers
========================= */

// snap to nearest 0.25mm (common increment)
function snap025(x) {
  return Math.round(x * 4) / 4;
}

// build a reasonable display range around target
function needleRange(target) {
  const snapped = snap025(target);
  const lower = snap025(snapped - 0.25);
  const upper = snap025(snapped + 0.25);
  // avoid negative
  return [Math.max(0.25, lower), Math.max(0.25, upper)];
}

// percent diff helper
function relDiff(a,b) {
  // relative difference from 1.0: a/b
  const r = a / b;
  return Math.abs(r - 1);
}

function formatMm(x) {
  // keep 2 decimals if needed, otherwise 1
  const s = (Math.round(x * 100) / 100).toString();
  return s;
}

/* =========================
   Main
========================= */
document.addEventListener("DOMContentLoaded", () => {
  // language buttons
  document.getElementById("btnJa").addEventListener("click", () => applyLang("ja"));
  document.getElementById("btnEn").addEventListener("click", () => applyLang("en"));

  // unit buttons
  document.getElementById("btnCm").addEventListener("click", () => applyUnit("cm"));
  document.getElementById("btnIn").addEventListener("click", () => applyUnit("in"));

  // init
  applyLang(currentLang);   // also calls applyUnit

  // calc
  document.getElementById("calcBtn").addEventListener("click", () => {
    const t = i18n[currentLang];

    const pSt = parseFloat(document.getElementById("pSt").value);
    const pRow = parseFloat(document.getElementById("pRow").value);
    const ySt = parseFloat(document.getElementById("ySt").value);
    const yRow = parseFloat(document.getElementById("yRow").value);
    const needle = parseFloat(document.getElementById("needleMm").value);

    const headline = document.getElementById("headline");
    const sub1 = document.getElementById("sub1");
    const sub2 = document.getElementById("sub2");
    const sub3 = document.getElementById("sub3");
    const footerNote = document.getElementById("footerNote");

    sub2.innerHTML = "";
    sub3.innerHTML = "";
    footerNote.textContent = "";

    if (![pSt,pRow,ySt,yRow,needle].every(v => Number.isFinite(v) && v > 0)) {
      headline.textContent = t.err;
      sub1.textContent = "";
      return;
    }

    // needle recommendation primarily from stitch gauge
    const stitchRatio = ySt / pSt;              // >1 => tighter (more stitches) => need larger needle
    const recNeedle = needle * stitchRatio;

    const smallDiff = relDiff(ySt, pSt) <= 0.03; // within 3% => basically fine

    // direction
    const directionText = (ySt > pSt) ? t.directionUp : t.directionDown;

    // build outputs
    if (smallDiff) {
      headline.textContent = t.keepNeedle;
    } else {
      const [lo, hi] = needleRange(recNeedle);
      headline.textContent = t.tryNeedle(formatMm(lo), formatMm(hi));
    }

    // detail pills
    const unitText = (currentUnit === "cm") ? (currentLang==="ja" ? "10cm" : "10 cm") : (currentLang==="ja" ? "4inch" : "4 in");
    sub1.innerHTML =
      `<span class="pill">${t.stitchDelta(pSt, ySt)} / ${unitText}</span>` +
      `<span class="pill">${t.rowDelta(pRow, yRow)} / ${unitText}</span>` +
      `<span class="pill">${currentLang==="ja" ? "ç¾åœ¨ã®é‡" : "Current needle"}: ${formatMm(needle)} mm</span>`;

    // direction line (sub2)
    if (smallDiff) {
      sub2.innerHTML = `<span class="ok">${
        currentLang === "ja"
          ? "æŒ‡å®šã‚²ãƒ¼ã‚¸ã«ã»ã¼ä¸€è‡´ã—ã¦ã„ã¾ã™ ğŸ‘"
          : "Your stitch gauge is very close ğŸ‘"
      }</span>`;
    } else {
      sub2.innerHTML = `<span class="warn">${directionText}</span>`;
    }

    // row analysis
    const rowDiffOk = relDiff(yRow, pRow) <= 0.05; // within 5%
    if (rowDiffOk) {
      sub3.innerHTML = `<span class="ok">${t.rowOk}</span>`;
    } else {
      sub3.innerHTML = `<span class="muted">${t.rowNote}</span>`;
    }

    footerNote.textContent = t.disclaimer;
  });
});
</script>
</body>
</html>
