<!doctype html>
<html lang="ja">
<head>
    <meta name="google-site-verification" content="roIDWRbDD6DNTvcDg5RXmFdXb4aWarya16oUp98scw0" />
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title data-i18n="title">ğŸ§¶ ã²ããã‚ãˆãƒ¡ãƒ¼ã‚«ãƒ¼ï½œStrand Maker</title>
  <meta name="description" content="ç›®æ¨™ã¨ã™ã‚‹ç³¸ã®å¤ªã•ã«è¿‘ã„ã€æ‰‹æŒã¡ç³¸ã®å¼•ãæƒãˆå€™è£œã‚’ææ¡ˆã—ã¾ã™ã€‚" />

  <style>
    .strand-container {
      max-width: 800px;
      margin: 2em auto;
      padding: 2em;
      background: #fefefe;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      font-family: 'Noto Sans JP', sans-serif;
    }
    h1 { text-align: center; font-size: 2rem; }
    p.description { text-align: center; color: #666; margin-bottom: 2em; }
    .input-group { margin-bottom: 1.5em; }
    .input-group label { font-weight: bold; display: block; margin-bottom: 0.3em; }
    .input-group input, .input-group select {
      width: 100%;
      padding: 0.5em;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .hint { font-size: 0.85rem; color: #999; margin-top: 0.3em; }
    .results { margin-top: 2em; }
    .results h2 { font-size: 1.2rem; margin-bottom: 1em; border-bottom: 2px solid #eee; padding-bottom: 0.5em; }
    .results ul { padding-left: 1.2em; }
    .results li { margin-bottom: 0.5em; }
    .btn-calculate {
      display: block;
      width: 100%;
      padding: 1em;
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      background-color: #007bff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 2em;
    }
    .btn-calculate:hover { background-color: #0056b3; }

    footer {
      margin-top: 2.5em;
      text-align: center;
      color: #999;
      font-size: 0.9rem;
    }

    .lang-switch {
      text-align: right;
      margin-bottom: 1em;
      font-size: 0.9rem;
    }
    .lang-switch button {
      background: none;
      border: none;
      cursor: pointer;
      color: #007bff;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="strand-container">

    <div class="lang-switch">
      <button onclick="setLang('ja')">JP</button> /
      <button onclick="setLang('en')">EN</button>
    </div>

    <h1 data-i18n="title">ğŸ§¶ ã²ããã‚ãˆãƒ¡ãƒ¼ã‚«ãƒ¼ï½œStrand Maker</h1>

    <p class="description" data-i18n="description">
      ç›®æ¨™ã¨ã™ã‚‹ç³¸ã®å¤ªã•ã«è¿‘ã„ã€æ‰‹æŒã¡ç³¸ã®å¼•ãæƒãˆå€™è£œã‚’ææ¡ˆã—ã¾ã™ã€‚
    </p>

    <form id="strand-form">

      <div class="input-group">
        <label data-i18n="yarnWeight">ğŸ“¦ ç›®æ¨™ã¨ã™ã‚‹ç³¸ã®å¤ªã•</label>
        <select id="yarn_weight">
          <option value="" disabled selected data-i18n="selectPlaceholder">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
          <option value="lace">Lace</option>
          <option value="fingering">Fingering</option>
          <option value="sport">Sport</option>
          <option value="dk">DK</option>
          <option value="worsted">Worsted</option>
          <option value="aran">Aran</option>
          <option value="bulky">Bulky</option>
          <option value="super_bulky">Super Bulky</option>
        </select>
      </div>

      <div class="input-group">
        <label data-i18n="length">ğŸ“ ç³¸ã®é•·ã•ï¼ˆmï¼‰</label>
        <input type="number" id="length" step="1" placeholder="200">
      </div>

      <div class="input-group">
        <label data-i18n="weight">âš–ï¸ ç³¸ã®é‡ã•ï¼ˆgï¼‰</label>
        <input type="number" id="weight" step="1" placeholder="50">
      </div>

      <div class="input-group">
        <label data-i18n="density">ğŸ¯ ç›®æ¨™å¯†åº¦ï¼ˆm/gï¼‰</label>
        <input type="number" id="density" step="0.01" readonly>
        <p class="hint" data-i18n="hintDensity">é•·ã• Ã· é‡ã• ã§è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚</p>
      </div>

      <div class="input-group">
        <label data-i18n="maxStrands">ğŸ”¢ æœ€å¤§æœ¬æ•°</label>
        <input type="number" id="max_strands" value="3" min="2" max="5">
      </div>

      <div class="input-group">
        <label data-i18n="comboRule">ğŸ§¶ çµ„ã¿åˆã‚ã›ã®ç¨®é¡</label>
        <select id="combo_rule">
          <option value="any" data-i18n="comboAny">åˆ¶é™ãªã—</option>
          <option value="same" data-i18n="comboSame">åŒã˜ç¨®é¡ã®ã¿</option>
          <option value="diff" data-i18n="comboDiff">ã™ã¹ã¦ç•°ãªã‚‹ç¨®é¡</option>
        </select>
      </div>

      <button type="button" id="calculate-btn" class="btn-calculate" data-i18n="calculate">
        å€™è£œã‚’è¨ˆç®—ã™ã‚‹
      </button>
    </form>

    <div class="results">
      <h2 data-i18n="resultsTitle">ğŸ§® ææ¡ˆã•ã‚ŒãŸçµ„ã¿åˆã‚ã›</h2>
      <ul id="results-list">
        <li data-i18n="initialResult">æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</li>
      </ul>
    </div>

    <footer>
      <small data-i18n="footer">by LemonJellyPool</small>
    </footer>
  </div>

  <script>
  /* ===== i18n ===== */
  const i18n = {
    ja: {
      title: "ğŸ§¶ ã²ããã‚ãˆãƒ¡ãƒ¼ã‚«ãƒ¼ï½œStrand Maker",
      description: "ç›®æ¨™ã¨ã™ã‚‹ç³¸ã®å¤ªã•ã«è¿‘ã„ã€æ‰‹æŒã¡ç³¸ã®å¼•ãæƒãˆå€™è£œã‚’ææ¡ˆã—ã¾ã™ã€‚",
      yarnWeight: "ğŸ“¦ ç›®æ¨™ã¨ã™ã‚‹ç³¸ã®å¤ªã•",
      length: "ğŸ“ ç³¸ã®é•·ã•ï¼ˆmï¼‰",
      weight: "âš–ï¸ ç³¸ã®é‡ã•ï¼ˆgï¼‰",
      density: "ğŸ¯ ç›®æ¨™å¯†åº¦ï¼ˆm/gï¼‰",
      hintDensity: "é•·ã• Ã· é‡ã• ã§è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚",
      maxStrands: "ğŸ”¢ æœ€å¤§æœ¬æ•°",
      comboRule: "ğŸ§¶ çµ„ã¿åˆã‚ã›ã®ç¨®é¡",
      comboAny: "åˆ¶é™ãªã—",
      comboSame: "åŒã˜ç¨®é¡ã®ã¿",
      comboDiff: "ã™ã¹ã¦ç•°ãªã‚‹ç¨®é¡",
      calculate: "å€™è£œã‚’è¨ˆç®—ã™ã‚‹",
      resultsTitle: "ğŸ§® ææ¡ˆã•ã‚ŒãŸçµ„ã¿åˆã‚ã›",
      initialResult: "æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚",
      selectPlaceholder: "-- é¸æŠã—ã¦ãã ã•ã„ --",
      footer: "by LemonJellyPool"
    },
    en: {
      title: "ğŸ§¶ Strand Maker",
      description: "Find strand combinations that match your target yarn thickness.",
      yarnWeight: "ğŸ“¦ Target yarn weight",
      length: "ğŸ“ Length (m)",
      weight: "âš–ï¸ Weight (g)",
      density: "ğŸ¯ Target density (m/g)",
      hintDensity: "Automatically calculated as length Ã· weight.",
      maxStrands: "ğŸ”¢ Max strands",
      comboRule: "ğŸ§¶ Combination rule",
      comboAny: "Any",
      comboSame: "Same type only",
      comboDiff: "All different",
      calculate: "Calculate combinations",
      resultsTitle: "ğŸ§® Suggested combinations",
      initialResult: "Enter values and press the button.",
      selectPlaceholder: "-- Select --",
      footer: "by LemonJellyPool"
    }
  };

  function setLang(lang) {
    localStorage.setItem("lang", lang);
    applyLang(lang);
  }

  function applyLang(lang) {
    const dict = i18n[lang];
    document.documentElement.lang = lang;

    // data-i18n ã®æ–‡å­—ã‚’ç½®æ›
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.dataset.i18n;
      if (dict[key]) el.textContent = dict[key];
    });

    // <meta name="description"> ã‚‚åˆ‡ã‚Šæ›¿ãˆãŸã„ãªã‚‰ï¼ˆä»»æ„ï¼‰
    const metaDesc = document.querySelector('meta[name="description"]');
    if (metaDesc) {
      metaDesc.setAttribute("content", dict.description);
    }
  }

  /* ===== logic ===== */
  const yarnMaster = {
    lace: { example_m: 700, example_g: 100 },
    fingering: { example_m: 400, example_g: 100 },
    sport: { example_m: 330, example_g: 100 },
    dk: { example_m: 260, example_g: 100 },
    worsted: { example_m: 220, example_g: 100 },
    aran: { example_m: 170, example_g: 100 },
    bulky: { example_m: 110, example_g: 100 },
    super_bulky: { example_m: 80, example_g: 100 }
  };

  const candidateYarns = [
    { name: "Lace", m_per_g: 7.0 },
    { name: "Fingering", m_per_g: 4.0 },
    { name: "Sport", m_per_g: 3.2 },
    { name: "DK", m_per_g: 2.7 },
    { name: "Worsted", m_per_g: 2.2 },
    { name: "Aran", m_per_g: 1.8 },
    { name: "Bulky", m_per_g: 1.3 },
    { name: "Super Bulky", m_per_g: 0.8 }
  ];

  function combinationsWithReplacement(arr, len) {
    const res = [];
    function backtrack(combo, start) {
      if (combo.length === len) return res.push(combo);
      for (let i = start; i < arr.length; i++) backtrack([...combo, arr[i]], i);
    }
    backtrack([], 0);
    return res;
  }

  function getSuggestions(target, maxStrands) {
    const suggestions = [];
    const yarns = candidateYarns.map(y => ({ ...y, gpm: 1 / y.m_per_g }));

    for (let r = 2; r <= maxStrands; r++) {
      for (const combo of combinationsWithReplacement(yarns, r)) {
        const sum = combo.reduce((s, y) => s + y.gpm, 0);
        const density = 1 / sum;
        if (Math.abs(density - target) <= 0.5) {
          suggestions.push({
            text: `${combo.map(y => y.name).join(" + ")} (${density.toFixed(2)} m/g)`,
            diff: Math.abs(density - target)
          });
        }
      }
    }

    // èª¤å·®ãŒå°ã•ã„é †ã«
    suggestions.sort((a, b) => a.diff - b.diff);
    return suggestions;
  }

  /* ===== DOM & init ===== */
  document.addEventListener("DOMContentLoaded", () => {
    // i18n åˆæœŸé©ç”¨
    applyLang(localStorage.getItem("lang") || "ja");

    // DOMã‚’å®‰å…¨ã«å–å¾—
    const select = document.getElementById("yarn_weight");
    const lengthInput = document.getElementById("length");
    const weightInput = document.getElementById("weight");
    const densityInput = document.getElementById("density");
    const maxStrandsInput = document.getElementById("max_strands");
    const calculateBtn = document.getElementById("calculate-btn");
    const resultsList = document.getElementById("results-list");

    function updateDensity() {
      const m = parseFloat(lengthInput.value);
      const g = parseFloat(weightInput.value);
      densityInput.value = (m > 0 && g > 0) ? (m / g).toFixed(2) : "";
    }

    function renderResults() {
      const d = parseFloat(densityInput.value);
      resultsList.innerHTML = "";

      if (!d || d <= 0) {
        resultsList.innerHTML = `<li>${i18n[localStorage.getItem("lang") || "ja"].initialResult}</li>`;
        return;
      }

      const maxStrands = parseInt(maxStrandsInput.value, 10);
      const res = getSuggestions(d, maxStrands);

      resultsList.innerHTML = res.length
        ? res.map(r => `<li>${r.text}</li>`).join("")
        : `<li>No combinations found.</li>`;
    }

    select.addEventListener("change", () => {
      const v = select.value;
      if (yarnMaster[v]) {
        lengthInput.value = yarnMaster[v].example_m;
        weightInput.value = yarnMaster[v].example_g;
        updateDensity();
      }
    });

    lengthInput.addEventListener("input", updateDensity);
    weightInput.addEventListener("input", updateDensity);
    calculateBtn.addEventListener("click", renderResults);

    // åˆæœŸè¨ˆç®—ï¼ˆä»»æ„ï¼‰
    updateDensity();
  });
  </script>

</body>
</html>
